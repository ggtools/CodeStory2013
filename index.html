<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>Codestory2013 by ggtools</title>

    <link rel="stylesheet" href="stylesheets/styles.css">
    <link rel="stylesheet" href="stylesheets/pygment_trac.css">
    <script src="javascripts/scale.fix.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="wrapper">
      <header>
        <h1>Codestory2013</h1>
        <p>Journal de ma participation à CodeStory2013</p>
        <p class="view"><a href="https://github.com/ggtools/CodeStory2013">View the Project on GitHub <small>ggtools/CodeStory2013</small></a></p>
        <ul>
          <li><a href="https://github.com/ggtools/CodeStory2013/zipball/master">Download <strong>ZIP File</strong></a></li>
          <li><a href="https://github.com/ggtools/CodeStory2013/tarball/master">Download <strong>TAR Ball</strong></a></li>
          <li><a href="https://github.com/ggtools/CodeStory2013">View On <strong>GitHub</strong></a></li>
        </ul>
      </header>
      <section>
        <h2>Au début …</h2>

<p>Il n'y avait rien. Enfin pas complètement rien car il y avait ça :</p>

<blockquote>
<p>Chaque développeur […] devra également installer un serveur web public […] l’équipe de CodeStory va poser une question au serveur […] au travers d’une requête http GET. […] La réponse doit être fournie dans le body de la réponse de la requête http.</p>

<p>La première question est simple. […] <code>http://(serveur)/?q=Quelle+est+ton+adresse+email</code> de votre serveur doit répondre par un document ne contenant que votre adresse email.</p>
</blockquote>

<p>N'ayant pas <em>a priori</em> trop de temps à consacrer à Code Story j'ai préféré rester dans le classique : Java 7 &amp; Tomcat. Pour l'hébergement, j'avais ouvert un compte sur <a href="http:/www.cloudbees.com/">Cloudbees</a> depuis la présentation de <a href="http://www.loof.fr/">Nicolas De Loof</a> au <a href="http://www.bordeauxjug.org">BordeauxJUG</a> que j'allais pouvoir mettre à contribution.</p>

<h2>Premières questions</h2>

<p>L'implémentation des premières questions se fait rapidement en jetant un coup d'œil sur les logs et en ajoutant le couple question/réponse avant de redéployer. Lorsqu'arrive "<code>Es tu pret a recevoir une enonce au format markdown par http post(OUI/NON)</code>" je pars sur une implémentation minimale ("use the logs Luke" me souffle une petite voix dans ma tête).</p>

<p>Cette première partie ne posa pas de problème &amp; ne fut pas chronophage : jusque là tout va bien …</p>

<h2>L'échoppe de monade sur Scalaskel</h2>

<p>J'ai commencé pour un rapide refactoring pour introduire l'interface <code>Resolver</code>. Ensuite un rapide brainstorming avec moi même pour choisir Jackson pour le formatage du JSon. L'algorithme final est récursif et utilise une enum pour stocker les différentes pièces :</p>

<div class="highlight"><pre><span class="kd">protected</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Map</span><span class="o">&lt;</span><span class="n">COIN</span><span class="o">,</span> <span class="n">Integer</span><span class="o">&gt;&gt;</span> <span class="n">computeChange</span><span class="o">(</span><span class="n">COIN</span> <span class="n">currentCoin</span><span class="o">,</span> <span class="kt">int</span> <span class="n">value</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">currentCoin</span><span class="o">.</span><span class="na">getValue</span><span class="o">()</span> <span class="o">==</span> <span class="mi">1</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">Map</span><span class="o">&lt;</span><span class="n">COIN</span><span class="o">,</span> <span class="n">Integer</span><span class="o">&gt;</span> <span class="n">changeMap</span> <span class="o">=</span> <span class="n">Maps</span><span class="o">.</span><span class="na">newHashMapWithExpectedSize</span><span class="o">(</span><span class="n">COIN</span><span class="o">.</span><span class="na">values</span><span class="o">().</span><span class="na">length</span><span class="o">);</span>
        <span class="n">addToChange</span><span class="o">(</span><span class="n">currentCoin</span><span class="o">,</span> <span class="n">value</span><span class="o">,</span> <span class="n">changeMap</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">Lists</span><span class="o">.</span><span class="na">newArrayList</span><span class="o">(</span><span class="n">changeMap</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="kt">int</span> <span class="n">maxCoins</span> <span class="o">=</span> <span class="n">value</span> <span class="o">/</span> <span class="n">currentCoin</span><span class="o">.</span><span class="na">getValue</span><span class="o">();</span>
    <span class="n">List</span><span class="o">&lt;</span><span class="n">Map</span><span class="o">&lt;</span><span class="n">COIN</span><span class="o">,</span> <span class="n">Integer</span><span class="o">&gt;&gt;</span> <span class="n">results</span> <span class="o">=</span> <span class="n">Lists</span><span class="o">.</span><span class="na">newArrayList</span><span class="o">();</span>
    <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="n">maxCoins</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">Map</span><span class="o">&lt;</span><span class="n">COIN</span><span class="o">,</span> <span class="n">Integer</span><span class="o">&gt;&gt;</span> <span class="n">subChanges</span> <span class="o">=</span> <span class="n">computeChange</span><span class="o">(</span><span class="n">COIN</span><span class="o">.</span><span class="na">values</span><span class="o">()[</span><span class="n">currentCoin</span><span class="o">.</span><span class="na">ordinal</span><span class="o">()</span> <span class="o">-</span> <span class="mi">1</span><span class="o">],</span> <span class="n">value</span> <span class="o">-</span> <span class="n">i</span> <span class="o">*</span> <span class="n">currentCoin</span><span class="o">.</span><span class="na">getValue</span><span class="o">());</span>
        <span class="k">for</span> <span class="o">(</span><span class="n">Map</span><span class="o">&lt;</span><span class="n">COIN</span><span class="o">,</span> <span class="n">Integer</span><span class="o">&gt;</span> <span class="n">change</span> <span class="o">:</span> <span class="n">subChanges</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">addToChange</span><span class="o">(</span><span class="n">currentCoin</span><span class="o">,</span> <span class="n">i</span><span class="o">,</span> <span class="n">change</span><span class="o">);</span>
            <span class="n">results</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">change</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>
    <span class="k">return</span> <span class="n">results</span><span class="o">;</span>
<span class="o">}</span>
</pre></div>

<p>Déploiement, petits coup d'œil aux logs pour surveiller le passage du robot … <em>yes !</em> il est passé &amp; visiblement mes résultats sont corrects. Et puis arrive ça : <code>1 1</code> … </p>

<h2>Calculatrice</h2>

<p>Solitude, interrogation avant de me rendre compte qu'il fallait regarder la question <strong>avant</strong> décodage du paramètre. J'ai fait deux implémentation de la calculatrice : une première en utilisant <a href="http://www.objecthunter.net/exp4j/index.html">exp4j</a> plutôt que Groovy qui ressemblait à un marteau-pillon pour casser une noix. Ça a marché pas trop mal jusqu'à ça :</p>

<pre><code>((1,1+2)+3,14+4+(5+6+7)+(8+9+10)*4267387833344334647677634)/2*553344300034334349999000
</code></pre>

<p>Exp4j faisant les calculs avec des doubles j'ai perdu du monde au passage et le robot n'a pas aimé. La solution est bien sûr de passer par <code>BigDecimal</code> mais exp4j n'est malheureusement pas conçu autour d'un pattern visitor donc très très difficile de changer la manière dont sont fait les calculs.</p>

<p>Finalement le marteau-pillon a du bon et Groovy ce sera.</p>

<h2>Jajascript</h2>

<p>Pour le deuxième énoncé je commence par une implémentation récursive et assez naïve (mais qui évite de faire des calculs en double). Les quelques tests donnent des résultats assez satisfaisant en terme de temps de réponse. Le robot étant en RTT le week-end où j'ai codé mon algorithme je me suis lancé confiant dans le codage d'un petit test de performance qui va faire des tests avec un nombre variable de vols. Et là … catastrophe, les temps de réponses deviennent catastrophiques lorsque je dépasse 100 vols. Je ne sais pas encore combien de vols il y aura au maximum mais il va falloir un changement radical d'algorithme. </p>

<h3>Welcome to GitHub Pages.</h3>

<p>This automatic page generator is the easiest way to create beautiful pages for all of your projects. Author your page content here using GitHub Flavored Markdown, select a template crafted by a designer, and publish. After your page is generated, you can check out the new branch:</p>

<pre><code>$ cd your_repo_root/repo_name
$ git fetch origin
$ git checkout gh-pages
</code></pre>

<p>If you're using the GitHub for Mac, simply sync your repository and you'll see the new branch.</p>

<h3>Designer Templates</h3>

<p>We've crafted some handsome templates for you to use. Go ahead and continue to layouts to browse through them. You can easily go back to edit your page before publishing. After publishing your page, you can revisit the page generator and switch to another theme. Your Page content will be preserved if it remained markdown format.</p>

<h3>Rather Drive Stick?</h3>

<p>If you prefer to not use the automatic generator, push a branch named <code>gh-pages</code> to your repository to create a page manually. In addition to supporting regular HTML content, GitHub Pages support Jekyll, a simple, blog aware static site generator written by our own Tom Preston-Werner. Jekyll makes it easy to create site-wide headers and footers without having to copy them across every page. It also offers intelligent blog support and other advanced templating features.</p>

<h3>Authors and Contributors</h3>

<p>You can <a href="https://github.com/blog/821" class="user-mention">@mention</a> a GitHub username to generate a link to their profile. The resulting <code>&lt;a&gt;</code> element will link to the contributor's GitHub Profile. For example: In 2007, Chris Wanstrath (<a href="https://github.com/defunkt" class="user-mention">@defunkt</a>), PJ Hyett (<a href="https://github.com/pjhyett" class="user-mention">@pjhyett</a>), and Tom Preston-Werner (<a href="https://github.com/mojombo" class="user-mention">@mojombo</a>) founded GitHub.</p>

<h3>Support or Contact</h3>

<p>Having trouble with Pages? Check out the documentation at <a href="http://help.github.com/pages">http://help.github.com/pages</a> or contact <a href="mailto:support@github.com">support@github.com</a> and we’ll help you sort it out.</p>
      </section>
    </div>
    <footer>
      <p>Project maintained by <a href="https://github.com/ggtools">ggtools</a></p>
      <p>Hosted on GitHub Pages &mdash; Theme by <a href="https://github.com/orderedlist">orderedlist</a></p>
    </footer>
    <!--[if !IE]><script>fixScale(document);</script><![endif]-->
    
  </body>
</html>